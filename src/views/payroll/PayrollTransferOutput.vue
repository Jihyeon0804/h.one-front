<template>
  <div class="payroll-transfer-output">
    <div class="page-header">
      <h1>ê¸‰ì—¬ ì´ì²´ ì¶œë ¥</h1>
      <p>ê¸‰ì—¬ ì´ì²´ë¥¼ ìœ„í•œ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì¶œë ¥í•©ë‹ˆë‹¤.</p>
    </div>
    
    <div class="content-section">
      <el-card>
        <template #header>
          <div class="card-header">
            <span>ê¸‰ì—¬ ì´ì²´ íŒŒì¼ ìƒì„±</span>
            <div class="header-actions">
<<<<<<< HEAD
              <el-button @click="generateCSVFile">CSV íŒŒì¼</el-button>
              <el-button @click="generateTXTFile">TXT íŒŒì¼</el-button>
=======
              <el-button @click="generateExcelFile">Excel íŒŒì¼</el-button>
              <el-button @click="generatePDFFile">PDF íŒŒì¼</el-button>
              <el-button @click="printDocument">ì¸ì‡„</el-button>
>>>>>>> develop
              <el-button type="primary" @click="downloadFile">ë‹¤ìš´ë¡œë“œ</el-button>
            </div>
          </div>
        </template>
        
        <div class="transfer-filters">
          <el-row :gutter="20">
            <el-col :span="8">
              <el-form-item label="ì´ì²´ ê¸°ê°„">
                <el-date-picker
                  v-model="transferPeriod"
                  type="month"
                  placeholder="ì´ì²´ ê¸°ê°„ ì„ íƒ"
                />
              </el-form-item>
            </el-col>
            <el-col :span="8">
              <el-form-item label="ì€í–‰">
                <el-select v-model="selectedBank" placeholder="ì€í–‰ ì„ íƒ">
                  <el-option label="ì „ì²´" value="" />
                  <el-option label="êµ­ë¯¼ì€í–‰" value="kb" />
                  <el-option label="ì‹ í•œì€í–‰" value="shinhan" />
                  <el-option label="ìš°ë¦¬ì€í–‰" value="woori" />
                </el-select>
              </el-form-item>
            </el-col>
            <el-col :span="8">
              <el-form-item label="íŒŒì¼ í˜•ì‹">
                <el-select v-model="fileFormat" placeholder="íŒŒì¼ í˜•ì‹ ì„ íƒ">
<<<<<<< HEAD
                  <el-option label="CSV" value="csv" />
                  <el-option label="Excel" value="excel" />
                  <el-option label="TXT" value="txt" />
=======
                  <el-option label="Excel" value="excel" />
                  <el-option label="PDF" value="pdf" />
>>>>>>> develop
                </el-select>
              </el-form-item>
            </el-col>
          </el-row>
        </div>
        
        <el-table :data="transferData" style="width: 100%" class="transfer-table">
<<<<<<< HEAD
          <el-table-column prop="employeeName" label="ì§ì›ëª…" min-width="120" align="center" />
          <el-table-column prop="accountNumber" label="ê³„ì¢Œë²ˆí˜¸" min-width="150" align="center" />
          <el-table-column prop="bankName" label="ì€í–‰" min-width="100" align="center" />
          <el-table-column prop="amount" label="ì´ì²´ê¸ˆì•¡" min-width="120" align="center">
=======
          <el-table-column prop="bankName" label="ì€í–‰" min-width="100" align="center" />
          <el-table-column prop="department" label="ë¶€ì„œ" min-width="100" align="center" />
          <el-table-column prop="employeeId" label="ì‚¬ë²ˆ" min-width="100" align="center" />
          <el-table-column prop="employeeName" label="ì˜ˆê¸ˆì£¼" min-width="120" align="center" />
          <el-table-column prop="accountNumber" label="ê³„ì¢Œë²ˆí˜¸" min-width="150" align="center" />
          <el-table-column prop="amount" label="ì…ê¸ˆì•¡" min-width="120" align="center">
>>>>>>> develop
            <template #default="scope">
              {{ scope.row.amount.toLocaleString() }}ì›
            </template>
          </el-table-column>
<<<<<<< HEAD
          <el-table-column prop="transferDate" label="ì´ì²´ì¼" min-width="120" align="center" />
          <el-table-column label="ìƒíƒœ" min-width="100" align="center">
            <template #default="scope">
              <el-tag :type="scope.row.status === 'ì™„ë£Œ' ? 'success' : 'warning'">
                {{ scope.row.status }}
              </el-tag>
            </template>
          </el-table-column>
=======
>>>>>>> develop
        </el-table>
      </el-card>
    </div>
  </div>
</template>

<script>
import { useSnackbar } from '@/composables/useSnackbar'
<<<<<<< HEAD
=======
import ExcelJS from 'exceljs'
>>>>>>> develop

export default {
  name: 'PayrollTransferOutput',
  setup() {
    const { success, error, warning, info } = useSnackbar()
    return { success, error, warning, info }
  },
  created() {
    // ëª©ì—… ë°ì´í„° ëŠ˜ë¦¬ê¸° (ì´ 80í–‰)
    const base = [...this.transferData]
    const targetCount = 80
    const mockNames = ['ê¹€ë¯¼ì¤€','ì´ì„œì—°','ë°•ë„ìœ¤','ìµœì§€ìš°','ì •í•˜ì¤€','í•œìœ ì§„','ì¡°ì¤€ì„œ','ìœ¤ì˜ˆë¦°','ì¥ìˆ˜ì•„','ì„ì‹œìš°','ì˜¤íƒœìœ¤','ì„œì—°ìš°','ì‹ ì•„ìœ¤','ê¶ŒìŠ¹í˜„','í™©ì¬ë¯¼','ë¬¸ì„œìœ¤','í™ì§€ì•ˆ','ê°•ìœ ë‚˜','ë°°ë¯¼ì„œ','ë¥˜í•˜ë¦°']
<<<<<<< HEAD
=======
    const departments = ['ê´€ë¦¬íŒ€', 'ì˜ì—…íŒ€', 'ê°œë°œíŒ€', 'ë§ˆì¼€íŒ…íŒ€', 'ì¸ì‚¬íŒ€', 'ì¬ë¬´íŒ€', 'ë””ìì¸íŒ€', 'QAíŒ€']
>>>>>>> develop
    let i = 0
    while (this.transferData.length < targetCount) {
      const src = base[i % base.length]
      const idx = this.transferData.length + 1
      const varied = {
<<<<<<< HEAD
        employeeName: mockNames[idx % mockNames.length],
=======
        employeeId: String(220500 + idx).padStart(6, '0'),
        employeeName: mockNames[idx % mockNames.length],
        department: departments[idx % departments.length],
>>>>>>> develop
        accountNumber: src.accountNumber.replace(/\d/g, (d) => ((+d + idx) % 10)),
        bankName: src.bankName,
        amount: src.amount + (idx % 7) * 5000,
        transferDate: src.transferDate,
        status: src.status
      }
      this.transferData.push(varied)
      i++
    }
  },
  data() {
    return {
      transferPeriod: new Date(),
      selectedBank: '',
<<<<<<< HEAD
      fileFormat: 'csv',
      transferData: [
        {
          employeeName: 'ê¹€ì² ìˆ˜',
          accountNumber: '123-456-789012',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 2747000,
=======
      fileFormat: 'excel',
      transferData: [
        {
          employeeName: 'ê¹€ì² ìˆ˜',
          employeeId: '220503',
          department: 'ê´€ë¦¬íŒ€',
          accountNumber: '285102-04-269765',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 3008550,
>>>>>>> develop
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì´ì˜í¬',
<<<<<<< HEAD
          accountNumber: '987-654-321098',
          bankName: 'ì‹ í•œì€í–‰',
          amount: 2624000,
=======
          employeeId: '220504',
          department: 'ê´€ë¦¬íŒ€',
          accountNumber: '285102-04-269766',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 2559910,
>>>>>>> develop
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ë°•ë¯¼ìˆ˜',
<<<<<<< HEAD
          accountNumber: '456-789-123456',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 2214000,
=======
          employeeId: '220505',
          department: 'ì˜ì—…íŒ€',
          accountNumber: '285102-04-269767',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 3200000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ìµœì§€ì˜',
          employeeId: '220506',
          department: 'ì˜ì—…íŒ€',
          accountNumber: '285102-04-269768',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 2800000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì •í•˜ì¤€',
          employeeId: '220507',
          department: 'ê°œë°œíŒ€',
          accountNumber: '285102-04-269769',
          bankName: 'êµ­ë¯¼ì€í–‰',
          amount: 3500000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'í•œìœ ì§„',
          employeeId: '220508',
          department: 'ë§ˆì¼€íŒ…íŒ€',
          accountNumber: '110-123-456789',
          bankName: 'ì‹ í•œì€í–‰',
          amount: 2800000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì¡°ì¤€ì„œ',
          employeeId: '220509',
          department: 'ë§ˆì¼€íŒ…íŒ€',
          accountNumber: '110-123-456790',
          bankName: 'ì‹ í•œì€í–‰',
          amount: 3200000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ìœ¤ì˜ˆë¦°',
          employeeId: '220510',
          department: 'ë§ˆì¼€íŒ…íŒ€',
          accountNumber: '110-123-456791',
          bankName: 'ì‹ í•œì€í–‰',
          amount: 2900000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì¥ìˆ˜ì•„',
          employeeId: '220511',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456789',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 3100000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì„ì‹œìš°',
          employeeId: '220512',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456790',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 2700000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì˜¤íƒœìœ¤',
          employeeId: '220513',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456791',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 3300000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì„œì—°ìš°',
          employeeId: '220514',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456792',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 2850000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ì‹ ì•„ìœ¤',
          employeeId: '220515',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456793',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 2950000,
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        },
        {
          employeeName: 'ê¶ŒìŠ¹í˜„',
          employeeId: '220516',
          department: 'ì¸ì‚¬íŒ€',
          accountNumber: '1002-123-456794',
          bankName: 'ìš°ë¦¬ì€í–‰',
          amount: 3200000,
>>>>>>> develop
          transferDate: '2024-09-25',
          status: 'ì™„ë£Œ'
        }
      ]
    }
  },
  methods: {
    generateFile() {
      this.success('ê¸‰ì—¬ ì´ì²´ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.')
    },
    downloadFile() {
<<<<<<< HEAD
      this.success('íŒŒì¼ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.')
    },
    // CSV ì´ì²´ íŒŒì¼ ìƒì„±
    generateCSVFile() {
      const headers = ['ì§ì›ëª…', 'ê³„ì¢Œë²ˆí˜¸', 'ì€í–‰', 'ì´ì²´ê¸ˆì•¡', 'ì´ì²´ì¼', 'ìƒíƒœ']
      const csvContent = [
        headers.join(','),
        ...this.transferData.map(item => [
          item.employeeName,
          item.accountNumber,
          item.bankName,
          item.amount,
          item.transferDate,
          item.status
        ].join(','))
      ].join('\n')

      const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' })
      const link = document.createElement('a')
      const url = URL.createObjectURL(blob)
      link.setAttribute('href', url)
      link.setAttribute('download', `ê¸‰ì—¬ì´ì²´íŒŒì¼_${new Date().toISOString().slice(0, 10)}.csv`)
=======
      if (this.fileFormat === 'excel') {
        this.generateExcelFile()
      } else if (this.fileFormat === 'pdf') {
        this.generatePDFFile()
      }
    },
    
    // Excel íŒŒì¼ ìƒì„± (ì…€ ë³‘í•© ë° ìŠ¤íƒ€ì¼ë§ í¬í•¨)
    async generateExcelFile() {
      const workbook = new ExcelJS.Workbook()
      const worksheet = workbook.addWorksheet('ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ')
      
      // ë°ì´í„°ë¥¼ ì€í–‰ë³„, ë¶€ì„œë³„ë¡œ ê·¸ë£¹í™”
      const groupedData = this.groupDataByBankAndDepartment()
      
      // ì œëª© ì¶”ê°€
      const titleRow = worksheet.addRow(['09ì›”ë¶„ ê¸‰ì—¬ì´ì²´'])
      titleRow.getCell(1).font = { size: 16, bold: true }
      titleRow.getCell(1).alignment = { horizontal: 'center' }
      worksheet.mergeCells('A1:F1')
      
      // ë¹ˆ í–‰ ì¶”ê°€
      worksheet.addRow([])
      
      // í—¤ë” ì¶”ê°€
      const headerRow = worksheet.addRow(['ì€í–‰', 'ë¶€ì„œ', 'ì‚¬ë²ˆ', 'ì˜ˆê¸ˆì£¼', 'ê³„ì¢Œë²ˆí˜¸', 'ì…ê¸ˆì•¡'])
      headerRow.eachCell((cell) => {
        cell.font = { bold: true }
        cell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FFE6E6FA' }
        }
        cell.border = {
          top: { style: 'thin' },
          left: { style: 'thin' },
          bottom: { style: 'thin' },
          right: { style: 'thin' }
        }
        cell.alignment = { horizontal: 'center' }
      })
      
      let totalAmount = 0
      let totalCount = 0
      let currentRow = 4 // ì œëª©(1) + ë¹ˆí–‰(1) + í—¤ë”(1) + ë‹¤ìŒí–‰(1) = 4
      
      // ê° ì€í–‰ë³„ë¡œ ì²˜ë¦¬
      Object.keys(groupedData).forEach(bankName => {
        const bankData = groupedData[bankName]
        let bankTotalAmount = 0
        let bankTotalCount = 0
        
        // ê° ë¶€ì„œë³„ë¡œ ì²˜ë¦¬
        Object.keys(bankData).forEach(department => {
          const deptData = bankData[department]
          let deptTotalAmount = 0
          let deptCount = 0
          
          // ê°œë³„ ì§ì› ë°ì´í„° ì¶”ê°€
          deptData.forEach(employee => {
            const row = worksheet.addRow([
              employee.bankName,
              employee.department,
              employee.employeeId,
              employee.employeeName,
              employee.accountNumber,
              employee.amount.toLocaleString()
            ])
            
            // í…Œë‘ë¦¬ ì¶”ê°€
            row.eachCell((cell, colNumber) => {
              cell.border = {
                top: { style: 'thin' },
                left: { style: 'thin' },
                bottom: { style: 'thin' },
                right: { style: 'thin' }
              }
              // ì…ê¸ˆì•¡ ì—´(Fì—´)ì€ ì˜¤ë¥¸ìª½ ì •ë ¬, ë‚˜ë¨¸ì§€ëŠ” ê°€ìš´ë° ì •ë ¬
              if (colNumber === 6) {
                cell.alignment = { horizontal: 'right', vertical: 'middle' }
              } else {
                cell.alignment = { horizontal: 'center', vertical: 'middle' }
              }
            })
            
            deptTotalAmount += employee.amount
            deptCount++
            currentRow++
          })
          
          // ë¶€ì„œê³„ ì¶”ê°€
          const deptSummaryRow = worksheet.addRow([
            bankName,
            department,
            '',
            '',
            `${deptCount}ê±´`,
            deptTotalAmount.toLocaleString()
          ])
          
          // ë¶€ì„œê³„ ìŠ¤íƒ€ì¼ë§ ë° ê°€ë¡œ ì…€ ë³‘í•©
          deptSummaryRow.eachCell((cell, colNumber) => {
            cell.font = { bold: true }
            cell.fill = {
              type: 'pattern',
              pattern: 'solid',
              fgColor: { argb: 'FFF0F8FF' }
            }
            cell.border = {
              top: { style: 'thin' },
              left: { style: 'thin' },
              bottom: { style: 'thin' },
              right: { style: 'thin' }
            }
            // ì…ê¸ˆì•¡ ì—´(Fì—´)ì€ ì˜¤ë¥¸ìª½ ì •ë ¬, ë‚˜ë¨¸ì§€ëŠ” ê°€ìš´ë° ì •ë ¬
            if (colNumber === 6) {
              cell.alignment = { horizontal: 'right', vertical: 'middle' }
            } else {
              cell.alignment = { horizontal: 'center', vertical: 'middle' }
            }
          })
          
          // ë¶€ì„œê³„ì—ì„œ ì‚¬ë²ˆ, ì˜ˆê¸ˆì£¼, ê³„ì¢Œë²ˆí˜¸ ì…€ ë³‘í•© (C:E)
          worksheet.mergeCells(`C${currentRow}:E${currentRow}`)
          
          bankTotalAmount += deptTotalAmount
          bankTotalCount += deptCount
          currentRow++
        })
        
        // ì€í–‰ê³„ ì¶”ê°€
        const bankSummaryRow = worksheet.addRow([
          bankName,
          '',
          '',
          '',
          `${bankTotalCount}ê±´`,
          bankTotalAmount.toLocaleString()
        ])
        
        // ì€í–‰ê³„ ìŠ¤íƒ€ì¼ë§ ë° ê°€ë¡œ ì…€ ë³‘í•©
        bankSummaryRow.eachCell((cell, colNumber) => {
          cell.font = { bold: true }
          cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FFE0E0E0' }
          }
          cell.border = {
            top: { style: 'thin' },
            left: { style: 'thin' },
            bottom: { style: 'thin' },
            right: { style: 'thin' }
          }
          // ì…ê¸ˆì•¡ ì—´(Fì—´)ì€ ì˜¤ë¥¸ìª½ ì •ë ¬, ë‚˜ë¨¸ì§€ëŠ” ê°€ìš´ë° ì •ë ¬
          if (colNumber === 6) {
            cell.alignment = { horizontal: 'right', vertical: 'middle' }
          } else {
            cell.alignment = { horizontal: 'center', vertical: 'middle' }
          }
        })
        
        // ì€í–‰ê³„ì—ì„œ ë¶€ì„œ, ì‚¬ë²ˆ, ì˜ˆê¸ˆì£¼, ê³„ì¢Œë²ˆí˜¸ ì…€ ë³‘í•© (B:E)
        worksheet.mergeCells(`B${currentRow}:E${currentRow}`)
        
        totalAmount += bankTotalAmount
        totalCount += bankTotalCount
        currentRow++
      })
      
      // ì „ì²´ í•©ê³„ ì¶”ê°€
      const totalSummaryRow = worksheet.addRow([
        '',
        '',
        '',
        '',
        `${totalCount}ê±´`,
        totalAmount.toLocaleString()
      ])
      
      // ì „ì²´í•©ê³„ ìŠ¤íƒ€ì¼ë§ ë° ê°€ë¡œ ì…€ ë³‘í•©
      totalSummaryRow.eachCell((cell, colNumber) => {
        cell.font = { bold: true, size: 12 }
        cell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FFE6F7E6' }
        }
        cell.border = {
          top: { style: 'medium' },
          left: { style: 'thin' },
          bottom: { style: 'medium' },
          right: { style: 'thin' }
        }
        // ì…ê¸ˆì•¡ ì—´(Fì—´)ì€ ì˜¤ë¥¸ìª½ ì •ë ¬, ë‚˜ë¨¸ì§€ëŠ” ê°€ìš´ë° ì •ë ¬
        if (colNumber === 6) {
          cell.alignment = { horizontal: 'right', vertical: 'middle' }
        } else {
          cell.alignment = { horizontal: 'center', vertical: 'middle' }
        }
      })
      
      // ì „ì²´í•©ê³„ì—ì„œ ì€í–‰, ë¶€ì„œ, ì‚¬ë²ˆ, ì˜ˆê¸ˆì£¼, ê³„ì¢Œë²ˆí˜¸ ì…€ ë³‘í•© (A:E)
      worksheet.mergeCells(`A${currentRow}:E${currentRow}`)
      
      // ì„¸ë¡œ ì…€ ë³‘í•© ì²˜ë¦¬
      this.mergeVerticalCells(worksheet, groupedData)
      
      // ì—´ ë„ˆë¹„ ì„¤ì •
      worksheet.columns = [
        { width: 15 }, // ì€í–‰
        { width: 15 }, // ë¶€ì„œ
        { width: 10 }, // ì‚¬ë²ˆ
        { width: 12 }, // ì˜ˆê¸ˆì£¼
        { width: 20 }, // ê³„ì¢Œë²ˆí˜¸
        { width: 15 }  // ì…ê¸ˆì•¡
      ]
      
      // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      const buffer = await workbook.xlsx.writeBuffer()
      const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })
      const link = document.createElement('a')
      const url = URL.createObjectURL(blob)
      link.setAttribute('href', url)
      link.setAttribute('download', `09ì›”ë¶„ ê¸‰ì—¬ì´ì²´_${new Date().toISOString().slice(0, 10)}.xlsx`)
>>>>>>> develop
      link.style.visibility = 'hidden'
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
      
<<<<<<< HEAD
      this.success('CSV ì´ì²´ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')
    },
    // TXT ì´ì²´ íŒŒì¼ ìƒì„± (ì€í–‰ ì´ì²´ìš©)
    generateTXTFile() {
      const txtContent = this.transferData.map(item => 
        `${item.employeeName}|${item.accountNumber}|${item.bankName}|${item.amount}|${item.transferDate}|${item.status}`
      ).join('\n')

      const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8;' })
      const link = document.createElement('a')
      const url = URL.createObjectURL(blob)
      link.setAttribute('href', url)
      link.setAttribute('download', `ê¸‰ì—¬ì´ì²´íŒŒì¼_${new Date().toISOString().slice(0, 10)}.txt`)
      link.style.visibility = 'hidden'
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
      
      this.success('TXT ì´ì²´ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')
=======
      this.success('Excel íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')
    },
    
    // ë°ì´í„°ë¥¼ ì€í–‰ë³„, ë¶€ì„œë³„ë¡œ ê·¸ë£¹í™”í•˜ëŠ” ë©”ì„œë“œ
    groupDataByBankAndDepartment() {
      const grouped = {}
      
      this.transferData.forEach(employee => {
        if (!grouped[employee.bankName]) {
          grouped[employee.bankName] = {}
        }
        if (!grouped[employee.bankName][employee.department]) {
          grouped[employee.bankName][employee.department] = []
        }
        grouped[employee.bankName][employee.department].push(employee)
      })
      
      return grouped
    },
    
    // ì„¸ë¡œ ì…€ ë³‘í•© ì²˜ë¦¬ ë©”ì„œë“œ
    mergeVerticalCells(worksheet, groupedData) {
      let currentRow = 4 // í—¤ë” ë‹¤ìŒ í–‰ë¶€í„° ì‹œì‘
      
      Object.keys(groupedData).forEach(bankName => {
        const bankData = groupedData[bankName]
        const bankStartRow = currentRow
        let bankRowCount = 0
        
        Object.keys(bankData).forEach(department => {
          const deptData = bankData[department]
          const deptStartRow = currentRow
          let deptRowCount = 0
          
          // ê°œë³„ ì§ì› ë°ì´í„° í–‰ ìˆ˜ ê³„ì‚°
          deptData.forEach(() => {
            deptRowCount++
            currentRow++
          })
          
          // ë¶€ì„œê³„ í–‰ ì¶”ê°€
          deptRowCount++
          currentRow++
          
          // ë¶€ì„œë³„ ì„¸ë¡œ ì…€ ë³‘í•© (ë¶€ì„œëª…)
          if (deptRowCount > 1) {
            worksheet.mergeCells(`B${deptStartRow}:B${deptStartRow + deptRowCount - 1}`)
          }
          
          bankRowCount += deptRowCount
        })
        
        // ì€í–‰ê³„ í–‰ ì¶”ê°€
        bankRowCount++
        currentRow++
        
        // ì€í–‰ë³„ ì„¸ë¡œ ì…€ ë³‘í•© (ì€í–‰ëª…)
        if (bankRowCount > 1) {
          worksheet.mergeCells(`A${bankStartRow}:A${bankStartRow + bankRowCount - 1}`)
        }
      })
    },
    
    // PDF íŒŒì¼ ìƒì„± (ê°œì„ ëœ ë°©ì‹ - ì‚¬ìš©ìê°€ ì§ì ‘ ì €ì¥)
    async generatePDFFile() {
      try {
        // PDF ìƒì„±ì„ ìœ„í•œ HTML ìƒì„±
        const htmlContent = this.generatePDFHTMLFixed()
        
        // ìƒˆ ì°½ì—ì„œ HTML í‘œì‹œ
        const printWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes')
        printWindow.document.write(htmlContent)
        printWindow.document.close()
        
        // CSS ì¶”ê°€ (ì¸ì‡„ìš© ìŠ¤íƒ€ì¼)
        const style = printWindow.document.createElement('style')
        style.textContent = `
          @media print {
            body { margin: 0; }
            @page { margin: 0.5in; }
          }
          @media screen {
            body { margin: 20px; }
            .print-instructions {
              background: #f0f8ff;
              border: 1px solid #0066cc;
              border-radius: 5px;
              padding: 15px;
              margin-bottom: 20px;
              font-family: 'Malgun Gothic', sans-serif;
            }
            .print-instructions h3 {
              margin: 0 0 10px 0;
              color: #0066cc;
            }
            .print-instructions ol {
              margin: 0;
              padding-left: 20px;
            }
            .print-instructions li {
              margin-bottom: 5px;
            }
            .print-button {
              background: #0066cc;
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 5px;
              cursor: pointer;
              font-size: 14px;
              margin-right: 10px;
            }
            .print-button:hover {
              background: #0052a3;
            }
          }
        `
        printWindow.document.head.appendChild(style)
        
        // ì¸ì‡„ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
        const instructionsDiv = printWindow.document.createElement('div')
        instructionsDiv.className = 'print-instructions'
        instructionsDiv.innerHTML = `
          <h3>ğŸ“„ ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ ì¶œë ¥ ì•ˆë‚´</h3>
          <ol>
            <li><strong>ì¸ì‡„ ë²„íŠ¼</strong>ì„ í´ë¦­í•˜ê±°ë‚˜ <strong>Ctrl+P</strong>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</li>
            <li>ì¸ì‡„ ëŒ€í™”ìƒìì—ì„œ <strong>"ëŒ€ìƒ"</strong>ì„ <strong>"PDFë¡œ ì €ì¥"</strong> ë˜ëŠ” <strong>"Microsoft Print to PDF"</strong>ë¡œ ì„ íƒí•˜ì„¸ìš”</li>
            <li><strong>"ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥"</strong> ë˜ëŠ” <strong>"ì €ì¥"</strong>ì„ í´ë¦­í•˜ì„¸ìš”</li>
            <li>ì›í•˜ëŠ” íŒŒì¼ëª…ì„ ì…ë ¥í•˜ê³  <strong>"ì €ì¥"</strong>ì„ í´ë¦­í•˜ì„¸ìš”</li>
          </ol>
          <button class="print-button" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„/PDF ì €ì¥</button>
          <button class="print-button" onclick="window.close()">âŒ ì°½ ë‹«ê¸°</button>
        `
        printWindow.document.body.insertBefore(instructionsDiv, printWindow.document.body.firstChild)
        
        this.success('PDF ìƒì„± ì°½ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ì¸ì‡„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ PDFë¡œ ì €ì¥í•˜ì„¸ìš”.')
      } catch (error) {
        this.error('PDF íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
        console.error('PDF ìƒì„± ì˜¤ë¥˜:', error)
      }
    },
    
    // ì¸ì‡„ ê¸°ëŠ¥ (ê°œì„ ëœ ë°©ì‹)
    printDocument() {
      try {
        const htmlContent = this.generatePDFHTMLFixed()
        const printWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes')
        printWindow.document.write(htmlContent)
        printWindow.document.close()
        
        // CSS ì¶”ê°€
        const style = printWindow.document.createElement('style')
        style.textContent = `
          @media print {
            body { margin: 0; }
            @page { margin: 0.5in; }
          }
          @media screen {
            body { margin: 20px; }
            .print-instructions {
              background: #f0f8ff;
              border: 1px solid #0066cc;
              border-radius: 5px;
              padding: 15px;
              margin-bottom: 20px;
              font-family: 'Malgun Gothic', sans-serif;
            }
            .print-instructions h3 {
              margin: 0 0 10px 0;
              color: #0066cc;
            }
            .print-instructions ol {
              margin: 0;
              padding-left: 20px;
            }
            .print-instructions li {
              margin-bottom: 5px;
            }
            .print-button {
              background: #0066cc;
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 5px;
              cursor: pointer;
              font-size: 14px;
              margin-right: 10px;
            }
            .print-button:hover {
              background: #0052a3;
            }
          }
        `
        printWindow.document.head.appendChild(style)
        
        // ì¸ì‡„ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
        const instructionsDiv = printWindow.document.createElement('div')
        instructionsDiv.className = 'print-instructions'
        instructionsDiv.innerHTML = `
          <h3>ğŸ–¨ï¸ ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ ì¸ì‡„ ì•ˆë‚´</h3>
          <ol>
            <li><strong>ì¸ì‡„ ë²„íŠ¼</strong>ì„ í´ë¦­í•˜ê±°ë‚˜ <strong>Ctrl+P</strong>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</li>
            <li>ì¸ì‡„ ì„¤ì •ì„ í™•ì¸í•˜ê³  <strong>"ì¸ì‡„"</strong>ë¥¼ í´ë¦­í•˜ì„¸ìš”</li>
            <li>ë˜ëŠ” <strong>"PDFë¡œ ì €ì¥"</strong>ì„ ì„ íƒí•˜ì—¬ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
          </ol>
          <button class="print-button" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
          <button class="print-button" onclick="window.close()">âŒ ì°½ ë‹«ê¸°</button>
        `
        printWindow.document.body.insertBefore(instructionsDiv, printWindow.document.body.firstChild)
        
        this.success('ì¸ì‡„ ì°½ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ì¸ì‡„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¸ì‡„í•˜ì„¸ìš”.')
      } catch (error) {
        this.error('ì¸ì‡„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
        console.error('ì¸ì‡„ ì˜¤ë¥˜:', error)
      }
    },
    
    // PDFìš© HTML ìƒì„± (Excelê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ë§ ë° ì‹¤ì œ ì…€ ë³‘í•©)
    generatePDFHTML() {
      const groupedData = this.groupDataByBankAndDepartment()
      let totalAmount = 0
      let totalCount = 0
      
      let html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ</title>
          <style>
            body { 
              font-family: 'Malgun Gothic', sans-serif; 
              margin: 20px; 
              font-size: 12px;
            }
            .header { 
              text-align: center; 
              margin-bottom: 30px; 
            }
            .title { 
              font-size: 18px; 
              font-weight: bold; 
              margin-bottom: 10px; 
            }
            .date { 
              font-size: 12px; 
              color: #666; 
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-bottom: 20px; 
              table-layout: fixed;
            }
            th, td { 
              border: 1px solid #000; 
              padding: 6px; 
              text-align: center; 
              vertical-align: middle;
              font-size: 11px;
            }
            th { 
              background-color: #E6E6FA; 
              font-weight: bold; 
            }
            .amount { 
              text-align: right; 
            }
            .summary { 
              background-color: #E6F7E6; 
              font-weight: bold; 
              border-top: 2px solid #000;
              border-bottom: 2px solid #000;
            }
            .bank-summary { 
              background-color: #E0E0E0; 
              font-weight: bold; 
            }
            .dept-summary { 
              background-color: #F0F8FF; 
              font-weight: bold; 
            }
            .bank-cell {
              background-color: #E0E0E0;
              font-weight: bold;
              text-align: center;
              vertical-align: middle;
            }
            .dept-cell {
              background-color: #F0F8FF;
              font-weight: bold;
              text-align: center;
              vertical-align: middle;
            }
            .col-bank { width: 15%; }
            .col-dept { width: 15%; }
            .col-id { width: 10%; }
            .col-name { width: 12%; }
            .col-account { width: 20%; }
            .col-amount { width: 15%; }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              * { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; }
              th { background-color: #E6E6FA !important; }
              .summary { background-color: #E6F7E6 !important; }
              .bank-summary { background-color: #E0E0E0 !important; }
              .dept-summary { background-color: #F0F8FF !important; }
              .bank-cell { background-color: #E0E0E0 !important; }
              .dept-cell { background-color: #F0F8FF !important; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="title">09ì›”ë¶„ ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ</div>
            <div class="date">ìƒì„±ì¼: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</div>
            <div class="filename-suggestion" style="font-size: 11px; color: #666; margin-top: 5px;">
              ê¶Œì¥ íŒŒì¼ëª…: ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}_${new Date().toTimeString().slice(0, 8).replace(/:/g, '')}.pdf
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th class="col-bank">ì€í–‰</th>
                <th class="col-dept">ë¶€ì„œ</th>
                <th class="col-id">ì‚¬ë²ˆ</th>
                <th class="col-name">ì˜ˆê¸ˆì£¼</th>
                <th class="col-account">ê³„ì¢Œë²ˆí˜¸</th>
                <th class="col-amount">ì…ê¸ˆì•¡</th>
              </tr>
            </thead>
            <tbody>
      `
      
      // ê° ì€í–‰ë³„ë¡œ ì²˜ë¦¬
      Object.keys(groupedData).forEach(bankName => {
        const bankData = groupedData[bankName]
        let bankTotalAmount = 0
        let bankTotalCount = 0
        
        // ê° ë¶€ì„œë³„ë¡œ ì²˜ë¦¬
        Object.keys(bankData).forEach(department => {
          const deptData = bankData[department]
          let deptTotalAmount = 0
          let deptCount = 0
          
          // ê°œë³„ ì§ì› ë°ì´í„° ì¶”ê°€
          deptData.forEach((employee, index) => {
            const isFirstInDept = index === 0
            const isFirstInBank = Object.keys(bankData).indexOf(department) === 0 && isFirstInDept
            
            // ì€í–‰ëª… ì…€ ë³‘í•© (ì²« ë²ˆì§¸ ë¶€ì„œì˜ ì²« ë²ˆì§¸ ì§ì›ì—ì„œë§Œ)
            const bankRowSpan = isFirstInBank ? this.getBankRowSpan(groupedData, bankName) : ''
            const bankCellContent = isFirstInBank ? employee.bankName : ''
            const bankCellClass = isFirstInBank ? ' bank-cell' : ''
            
            // ë¶€ì„œëª… ì…€ ë³‘í•© (ë¶€ì„œì˜ ì²« ë²ˆì§¸ ì§ì›ì—ì„œë§Œ)
            const deptRowSpan = isFirstInDept ? deptData.length : ''
            const deptCellContent = isFirstInDept ? employee.department : ''
            const deptCellClass = isFirstInDept ? ' dept-cell' : ''
            
            html += `
              <tr>
                <td class="col-bank${bankCellClass}"${bankRowSpan ? ` rowspan="${bankRowSpan}"` : ''}>${bankCellContent}</td>
                <td class="col-dept${deptCellClass}"${deptRowSpan ? ` rowspan="${deptRowSpan}"` : ''}>${deptCellContent}</td>
                <td class="col-id">${employee.employeeId}</td>
                <td class="col-name">${employee.employeeName}</td>
                <td class="col-account">${employee.accountNumber}</td>
                <td class="col-amount amount">${employee.amount.toLocaleString()}</td>
              </tr>
            `
            deptTotalAmount += employee.amount
            deptCount++
          })
          
          // ë¶€ì„œê³„ ì¶”ê°€
          html += `
            <tr class="dept-summary">
              <td class="col-bank"></td>
              <td class="col-dept"></td>
              <td class="col-id"></td>
              <td class="col-name"></td>
              <td class="col-account">${deptCount}ê±´</td>
              <td class="col-amount amount">${deptTotalAmount.toLocaleString()}</td>
            </tr>
          `
          
          bankTotalAmount += deptTotalAmount
          bankTotalCount += deptCount
        })
        
        // ì€í–‰ê³„ ì¶”ê°€
        html += `
          <tr class="bank-summary">
            <td class="col-bank"></td>
            <td class="col-dept"></td>
            <td class="col-id"></td>
            <td class="col-name"></td>
            <td class="col-account">${bankTotalCount}ê±´</td>
            <td class="col-amount amount">${bankTotalAmount.toLocaleString()}</td>
          </tr>
        `
        
        totalAmount += bankTotalAmount
        totalCount += bankTotalCount
      })
      
      // ì „ì²´ í•©ê³„ ì¶”ê°€
      html += `
            <tr class="summary">
              <td class="col-bank"></td>
              <td class="col-dept"></td>
              <td class="col-id"></td>
              <td class="col-name"></td>
              <td class="col-account">${totalCount}ê±´</td>
              <td class="col-amount amount">${totalAmount.toLocaleString()}</td>
            </tr>
          </tbody>
        </table>
        </body>
        </html>
      `
      
      return html
    },
    
    // ì€í–‰ë³„ ì´ í–‰ ìˆ˜ ê³„ì‚° (ì…€ ë³‘í•©ìš©)
    getBankRowSpan(groupedData, bankName) {
      const bankData = groupedData[bankName]
      let totalRows = 0
      
      Object.keys(bankData).forEach(department => {
        const deptData = bankData[department]
        totalRows += deptData.length + 1 // ê°œë³„ ë°ì´í„° + ë¶€ì„œê³„
      })
      totalRows += 1 // ì€í–‰ê³„
      
      return totalRows
    },
    
    // PDFìš© HTML ìƒì„± (ì˜¬ë°”ë¥¸ ì…€ ë³‘í•© ë¡œì§ - ìˆ˜ì§ ì •ë ¬ ë° ìƒ‰ìƒ ë¬¸ì œ í•´ê²°)
    generatePDFHTMLFixed() {
      const groupedData = this.groupDataByBankAndDepartment()
      let totalAmount = 0
      let totalCount = 0
      
      let html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ</title>
          <style>
            body { 
              font-family: 'Malgun Gothic', sans-serif; 
              margin: 20px; 
              font-size: 12px;
            }
            .header { 
              text-align: center; 
              margin-bottom: 30px; 
            }
            .title { 
              font-size: 18px; 
              font-weight: bold; 
              margin-bottom: 10px; 
            }
            .date { 
              font-size: 12px; 
              color: #666; 
            }
            table { 
              width: 100%; 
              border-collapse: collapse; 
              margin-bottom: 20px; 
              table-layout: fixed;
            }
            th, td { 
              border: 1px solid #000; 
              padding: 8px 6px; 
              text-align: center; 
              vertical-align: middle;
              font-size: 11px;
              height: 35px;
              line-height: 1.2;
              box-sizing: border-box;
            }
            th { 
              background-color: #E6E6FA; 
              font-weight: bold; 
            }
            .amount { 
              text-align: right; 
            }
            .summary { 
              background-color: #E6F7E6; 
              font-weight: bold; 
              border-top: 2px solid #000;
              border-bottom: 2px solid #000;
            }
            .bank-summary { 
              background-color: #E0E0E0; 
              font-weight: bold; 
            }
            .dept-summary { 
              background-color: #F0F8FF; 
              font-weight: bold; 
            }
            .bank-cell {
              background-color: #E0E0E0 !important;
              font-weight: bold;
              text-align: center !important;
              vertical-align: middle !important;
              display: table-cell;
              position: relative;
            }
            .dept-cell {
              background-color: #F0F8FF !important;
              font-weight: bold;
              text-align: center !important;
              vertical-align: middle !important;
              display: table-cell;
              position: relative;
            }
            .col-bank { width: 15%; }
            .col-dept { width: 15%; }
            .col-id { width: 10%; }
            .col-name { width: 12%; }
            .col-account { width: 20%; }
            .col-amount { width: 15%; }
            @media screen {
              * { 
                -webkit-print-color-adjust: exact !important; 
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
            }
            @media print {
              body { margin: 0; }
              .no-print { display: none; }
              * { 
                -webkit-print-color-adjust: exact !important; 
                color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
              th { 
                background-color: #E6E6FA !important;
                color: #000 !important;
              }
              .summary { 
                background-color: #E6F7E6 !important;
                color: #000 !important;
              }
              .bank-summary { 
                background-color: #E0E0E0 !important;
                color: #000 !important;
              }
              .dept-summary { 
                background-color: #F0F8FF !important;
                color: #000 !important;
              }
              .bank-cell { 
                background-color: #E0E0E0 !important;
                color: #000 !important;
                vertical-align: middle !important;
                text-align: center !important;
              }
              .dept-cell { 
                background-color: #F0F8FF !important;
                color: #000 !important;
                vertical-align: middle !important;
                text-align: center !important;
              }
              td, th {
                border: 1px solid #000 !important;
                vertical-align: middle !important;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="title">09ì›”ë¶„ ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ</div>
            <div class="date">ìƒì„±ì¼: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</div>
            <div class="filename-suggestion" style="font-size: 11px; color: #666; margin-top: 5px;">
              ê¶Œì¥ íŒŒì¼ëª…: ê¸‰ì—¬ì´ì²´ëª…ì„¸ì„œ_${new Date().toISOString().slice(0, 10).replace(/-/g, '')}_${new Date().toTimeString().slice(0, 8).replace(/:/g, '')}.pdf
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th class="col-bank">ì€í–‰</th>
                <th class="col-dept">ë¶€ì„œ</th>
                <th class="col-id">ì‚¬ë²ˆ</th>
                <th class="col-name">ì˜ˆê¸ˆì£¼</th>
                <th class="col-account">ê³„ì¢Œë²ˆí˜¸</th>
                <th class="col-amount">ì…ê¸ˆì•¡</th>
              </tr>
            </thead>
            <tbody>
      `
      
      // ê° ì€í–‰ë³„ë¡œ ì²˜ë¦¬
      Object.keys(groupedData).forEach(bankName => {
        const bankData = groupedData[bankName]
        let bankTotalAmount = 0
        let bankTotalCount = 0
        
        // ê° ë¶€ì„œë³„ë¡œ ì²˜ë¦¬
        Object.keys(bankData).forEach(department => {
          const deptData = bankData[department]
          let deptTotalAmount = 0
          let deptCount = 0
          
          // ê°œë³„ ì§ì› ë°ì´í„° ì¶”ê°€
          deptData.forEach((employee, index) => {
            const isFirstInDept = index === 0
            const isFirstInBank = Object.keys(bankData).indexOf(department) === 0 && isFirstInDept
            
            html += `
              <tr>
            `
            
            // ì€í–‰ëª… ì…€ (ì²« ë²ˆì§¸ ë¶€ì„œì˜ ì²« ë²ˆì§¸ ì§ì›ì—ì„œë§Œ)
            if (isFirstInBank) {
              const bankRowSpan = this.getBankRowSpan(groupedData, bankName)
              html += `<td class="col-bank bank-cell" rowspan="${bankRowSpan}" style="vertical-align: middle; text-align: center; background-color: #E0E0E0;">${employee.bankName}</td>`
            }
            
            // ë¶€ì„œëª… ì…€ (ë¶€ì„œì˜ ì²« ë²ˆì§¸ ì§ì›ì—ì„œë§Œ)
            if (isFirstInDept) {
              html += `<td class="col-dept dept-cell" rowspan="${deptData.length + 1}" style="vertical-align: middle; text-align: center; background-color: #F0F8FF;">${employee.department}</td>`
            }
            
            // ë‚˜ë¨¸ì§€ ë°ì´í„° ì…€ë“¤
            html += `
                <td class="col-id">${employee.employeeId}</td>
                <td class="col-name">${employee.employeeName}</td>
                <td class="col-account">${employee.accountNumber}</td>
                <td class="col-amount amount">${employee.amount.toLocaleString()}</td>
              </tr>
            `
            deptTotalAmount += employee.amount
            deptCount++
          })
          
          // ë¶€ì„œê³„ ì¶”ê°€ (ê±´ìˆ˜ì™€ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë°°ì¹˜)
          html += `
            <tr class="dept-summary" style="background-color: #F0F8FF;">
              <td class="col-id" colspan="2" style="background-color: #F0F8FF; font-weight: bold;">ë¶€ì„œê³„</td>
              <td class="col-account" style="background-color: #F0F8FF; font-weight: bold;">${deptCount}ê±´</td>
              <td class="col-amount amount" style="background-color: #F0F8FF; font-weight: bold;">${deptTotalAmount.toLocaleString()}</td>
            </tr>
          `
          
          bankTotalAmount += deptTotalAmount
          bankTotalCount += deptCount
        })
        
        // ì€í–‰ê³„ ì¶”ê°€ (ê±´ìˆ˜ì™€ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë°°ì¹˜)
        html += `
          <tr class="bank-summary" style="background-color: #E0E0E0;">
            <td class="col-id" style="background-color: #E0E0E0;"></td>
            <td class="col-dept" colspan="2" style="background-color: #E0E0E0; font-weight: bold;">ì€í–‰ê³„</td>
            <td class="col-account" style="background-color: #E0E0E0; font-weight: bold;">${bankTotalCount}ê±´</td>
            <td class="col-amount amount" style="background-color: #E0E0E0; font-weight: bold;">${bankTotalAmount.toLocaleString()}</td>
          </tr>
        `
        
        totalAmount += bankTotalAmount
        totalCount += bankTotalCount
      })
      
      // ì „ì²´ í•©ê³„ ì¶”ê°€ (ê±´ìˆ˜ì™€ ê¸ˆì•¡ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ë°°ì¹˜)
      html += `
            <tr class="summary" style="background-color: #E6F7E6;">
              <td class="col-bank" style="background-color: #E6F7E6;"></td>
              <td class="col-dept" colspan="3" style="background-color: #E6F7E6; font-weight: bold;">ì´ê³„</td>
              <td class="col-account" style="background-color: #E6F7E6; font-weight: bold;">${totalCount}ê±´</td>
              <td class="col-amount amount" style="background-color: #E6F7E6; font-weight: bold;">${totalAmount.toLocaleString()}</td>
            </tr>
          </tbody>
        </table>
        </body>
        </html>
      `
      
      return html
>>>>>>> develop
    }
  }
}
</script>

<style scoped>
.payroll-transfer-output {
  padding: 20px;
}

.page-header {
  margin-bottom: 30px;
}

.page-header h1 {
  color: #2c3e50;
  margin-bottom: 8px;
}

.page-header p {
  color: #606266;
  font-size: 14px;
}

.content-section {
  margin-bottom: 20px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-header span {
  font-weight: 600;
  color: #2c3e50;
}

.header-actions {
  display: flex;
  gap: 10px;
}

.transfer-filters {
  margin-bottom: 20px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
}

.transfer-table {
  margin-top: 20px;
}
</style>
