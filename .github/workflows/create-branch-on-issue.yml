# íŒŒì¼ ê²½ë¡œ: .github/workflows/create-branch-on-issue.yml

name: Create Branch on New Issue (Title-based)

# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´: ì´ìŠˆê°€ ìƒˆë¡œ ìƒì„±ë˜ì—ˆì„ ë•Œ
on:
  issues:
    types: [opened]

jobs:
  create_branch_job:
    runs-on: ubuntu-latest
    steps:
      # 1. ì €ì¥ì†Œ ì½”ë“œë¥¼ ì›Œí¬í”Œë¡œìš° í™˜ê²½ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. ì´ìŠˆ ì •ë³´ë¡œ ë¸Œëœì¹˜ ì´ë¦„ì„ ìƒì„±í•©ë‹ˆë‹¤.
      - name: Create Branch Name
        id: branch_name
        run: |
          issue_title="${{ github.event.issue.title }}"
          
          if [[ $issue_title == \[*\]* ]]; then
            feature_name=$(echo "$issue_title" | sed -n 's/\[\(.*\)\] .*/\1/p' | tr '[:upper:]' '[:lower:]' | sed 's/ /-/g' | sed 's/[^a-z0-9-]//g')
          else
            feature_name=$(echo "$issue_title" | tr '[:upper:]' '[:lower:]' | sed 's/ /-/g' | sed 's/[^a-z0-9-]//g')
          fi

          issue_number="${{ github.event.issue.number }}"
          
          echo "branch_name=feature/${issue_number}-${feature_name}" >> $GITHUB_OUTPUT

      # 3. ìœ„ì—ì„œ ë§Œë“  ì´ë¦„ìœ¼ë¡œ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  ì›ê²© ì €ì¥ì†Œì— pushí•©ë‹ˆë‹¤.
      - name: Create and Push Branch
        run: |
          BRANCH_NAME="${{ steps.branch_name.outputs.branch_name }}"
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git checkout -b $BRANCH_NAME
          git push origin $BRANCH_NAME

      # 4. ìƒì„±ëœ ë¸Œëœì¹˜ ì •ë³´ë¥¼ ì´ìŠˆì— ëŒ“ê¸€ë¡œ ë‚¨ê¹ë‹ˆë‹¤.
      - name: Comment on Issue
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸš€ **ìë™ ìƒì„±ëœ ë¸Œëœì¹˜:** \`${{ steps.branch_name.outputs.branch_name }}\``
            })